"use strict";exports.id=411,exports.ids=[411],exports.modules={67797:(A,M,s)=>{s.r(M),s.d(M,{handleSquirrelEvents:()=>x});var g=s(75118),f=s(72298),K=s.n(f),l=s(70103),R=s.n(l),D=s(22037),F=s.n(D),a=s(71017),$=s.n(a),_=s(19534),c=s(73444),S=s(11324),O=s(98568),P=s(67980);const t=(e=>{const o=c.p`${"userData"}/logs/${e}.log`,n=(0,O.p)(console.log.bind(console));return Object.keys(g.B$).map(r=>g.B$[r]).reduce((r,i)=>(r[i]=(m,W)=>{try{const v=n({level:i,message:m,metaObject:W});l.appendFileSync(o,`${v}${D.EOL}`)}catch(v){console.log(v)}},r),{})})("squirrel-event"),I=a.resolve(a.dirname(process.execPath),"..","update.exe"),E=c.p`${"userDesktop"}/Slack.lnk`,u=c.p`${"appData"}/Microsoft/Windows/Start Menu/Programs/Startup/Slack.lnk`,h=c.p`${"appData"}/Microsoft/Windows/Start Menu/Programs/Slack Technologies Inc/Slack.lnk`,y=c.p`${"appData"}/Microsoft/Windows/Start Menu/Programs/Slack Technologies`;S.f.initialize(t),t.info("SquirrelEventHandler: setting paths for target",{squirrelUpdaterPath:I,desktopShortcutTargetPath:E,startupShortcutTargetPath:u,startMenuShortcutTargetPath:h});const p={pid:process.pid,exec:process.execPath,version:"4.33.73"};async function x(e){t.info("handleSquirrelEvents",{eventName:e});const o="Desktop,StartMenu",n="Desktop,StartMenu,Startup";try{return e==="install"?await k(o):e==="updated"?await T(o):e==="uninstall"&&await U(n),{hookFailed:!1}}catch(r){return t.error("handleSquirrelEvents: Event failed",{eventName:e,error:r}),{hookFailed:!0,error:r}}}async function k(e,o=!0){t.info("SquirrelEventHandler: onInstall hook invoked",{locations:e,enableAutoLaunch:o,processInfo:p}),o&&S.f.add(),B();const n=a.basename(process.execPath),r=a.resolve(a.dirname(process.execPath),"..","update.exe"),i=["--createShortcut",n,"-l",e];if(t.info("SquirrelEventHandler: onInstall hook resolved updater path",{target:n,updateDotExe:r,args:i}),l.existsSync(y))try{l.removeSync(y),t.info("onInstall: legacy start menu folder detected and removed.")}catch(m){t.error("onInstall: unable to remove legacy start menu folder",{error:m})}await(0,P.C)(r,i),t.info("SquirrelEventHandler: onInstall hook completed")}async function T(e){const o=l.existsSync(u),n=l.existsSync(E);t.info("SquirrelEventHandler: onUpdate hook invoked",{processInfo:p,hasStartupShortcut:o,hasDesktopShortcut:n}),o&&l.unlinkSync(u),e.match(/Desktop/)&&!n&&(e=e.split(",").filter(r=>r!=="Desktop").join(","),t.info("SquirrelEventHandler: onUpdate hook detected user removed desktop shortcut",{locations:e})),await k(e,o),t.info("SquirrelEventHandler: onUpdate hook completed")}async function U(e){t.info("SquirrelEventHandler: onUninstall hook invoked",{processInfo:p}),f.app.removeAsDefaultProtocolClient("slack"),S.f.remove(),[E,u,h].filter(r=>l.existsSync(r)).forEach(r=>{try{t.info("SquirrelEventHandler:onUninstall hook trying to delete shortcut",{shortcut:r}),l.unlinkSync(r)}catch{t.error("SquirrelEventHandler:onUninstall hook failed to remove shortcut",{shortcut:r})}}),C(),L();const o=c.p`${"SYSTEMROOT"}/system32/taskkill.exe`,n=["/F","/IM","slack.exe","/T"];await(0,P.C)(o,n)}function L(){const e=f.app.getPath("userData");d(a.join(e,"Cookies"),!1)&&d(a.join(e,"StaleCookies"),!1)&&d(a.join(e,"Local Storage"),!0)&&d(a.join(e,"storage"),!0)&&d(a.join(e,"IndexedDB"),!0)||t.error("removeSignInData: Not all sign-in related data could be deleted")}function d(e,o){try{return l.pathExistsSync(e)&&(o?l.removeSync(e):l.unlinkSync(e)),!0}catch(n){return t.error("removeSignInData: removePath: Failed to delete path",{error:n}),!1}}function C(){const e=a.dirname(h),o=l.existsSync(e);if(t.info("removeStartMenuFolder: trying to delete start menu folder",{folderLocation:e,hasFolderLocation:o}),o){t.info("removeStartMenuFolder: found start menu path, trying to delete");try{const n=l.readdirSync(e)||[];t.info("removeStartMenuFolder: checking contents under start menu folder",{contents:n}),n.length===0?(l.rmdirSync(e),t.info("removeStartMenuFolder: deleted start menu folder")):t.info("removeStartMenuFolder: skipping delete as remaining file found")}catch(n){t.error('Failed to check "Slack Technologies" folder: ',{error:n})}}}function B(){const e=a.dirname(process.execPath),o=a.resolve(process.resourcesPath,"VisualElementsManifest.xml"),n=a.resolve(e,"..","VisualElementsManifest.xml");(0,_.iO)(o,n);const r=a.resolve(process.resourcesPath,"slack.VisualElementsManifest.xml"),i=a.resolve(e,"..","slack.VisualElementsManifest.xml");(0,_.iO)(r,i)}}};

//# sourceMappingURL=411.bundle.js.map